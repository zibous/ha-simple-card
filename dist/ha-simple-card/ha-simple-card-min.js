/**
 * ha-simple-card 0.0.4
 * https://github.com/zibous/ha-simple-card
 * 
 * License: MIT
 * Generated on 2020
 * Author: Peter siebler
 */

class buttons{constructor(t){this.shadowRoot=t.shadowRoot,this.parentNode=t.parentNode,this.hass=t.hass,this.entities=t.entities,this.hassEntities=t.hassEntities,this.locale=t.locale,this.buttonstate={},this.buttonslist=[],this.button_layer=null,this.update=!1,this.intialized=!1,this.render()}set_buttonstyle(){if(!this.button_layer)return!1;const t=document.createElement("style");return t.textContent='\n            div.sc-buttons{\n                position:relative;\n                width:100%;\n                height:100%\n            }\n            .clearfix::before, .clearfix::after {\n                content: " ";\n                display: table;\n            }\n            div.sc-button{\n                vertical-align: top;\n                display:inline-block;\n                width: var(--tile-width, 110px);\n                height: var(--tile-height, 110px);\n                padding:10px;\n                background-color: var(--tile-background, rgba(255, 255, 255, 1));\n                border-radius: var(--tile-border-radius, 12px);\n                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);\n                margin: 0.5em;\n                position: relative;\n                overflow:hidden;\n                font-weight:300;\n                font-size: 0.95em;\n                color: var(--tile-on-name-text-color, rgba(0, 0, 0, 1));\n                touch-action: auto!important;\n            }\n            div.sc-button.off {\n                filter: brightness(0.7) !important;\n                color: var(--tile-on-name-text-color, rgba(0, 0, 0, 0.60)) !important;\n            }\n            div.sc-button-data{\n                position: absolute;\n                left: 0;\n                bottom: 8px;\n                width: 100%;\n                background: transparent;\n            }\n            div.sc-button-name{\n                margin: 0 8px;  \n                font-weight: 500;\n                width: 90%;\n                overflow:hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            div.sc-button-value{\n                margin: 0 8px;  \n                width: 85%;\n                font-weight: 500;\n                text-align:right;\n                overflow:hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            div.sc-button-date{\n                margin: 0 8px;  \n                text-align: right;\n                width: 85%;\n                overflow:hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n                font-size: 0.85em;\n            }\n            .circle-state {\n                stroke-dasharray: calc((251.2 / 100) * var(--percentage)), 251.2;\n                position:absolute;\n                margin:0;\n                top:10px;\n                right:10px;\n                width: 40px;\n                height: 40px;\n                cursor: pointer;\n            }\n\n            div.sc-button .icon {\n                display:block;\n                height: calc(var(--tile-icon-size, 30px) + 10px);\n                width: calc(var(--tile-icon-size, 30px) + 10px);\n                color: var(--tile-icon-color, rgba(0, 0, 0, 0.3));\n                font-size: var(--tile-icon-size, 30px);\n                --mdc-icon-size: var(--tile-icon-size, 30px);\n                transform-origin: 50% 50%;\n                line-height: calc(var(--tile-icon-size, 30px) + 10px);\n                text-align: center;\n                pointer-events: none;\n                position: absolute;\n                top: 8px;\n                left:8px;\n            }\n            div.sc-button .icon.on {\n                color: var(--tile-on-icon-color, #f7d959);\n            }\n            div.sc-button .icon.off {\n                color: var(--tile-icon-color, rgba(0, 0, 0, 0.3));\n            }\n            div.sc-button .icon.image img {\n                width:100%;\n                border-radius: var(--tile-image-radius, 100%)\n            }\n    \n            div.sc-button .icon ha-icon {\n                width:30px;\n                height:30px;\n                pointer-events: none;\n            }\n        ',this.parentNode.append(t),!0}_calculateTime(t){const e=new Date,n=new Date(t),i=e.getTime()-n.getTime(),s=Math.floor(i/864e5),a=Math.floor(i%864e5/36e5),o=Math.round(i%864e5%36e5/6e4),r=Math.round(i%864e5%36e5%6e4/1e3);return s>0?s+" d":a>0?a+" h":o>0?o+" m":r+" s"}_checkButtonState(t,e){this.buttonstate={status:["off","unavailable"].includes(e.value)?"off":"on"},"off"===this.buttonstate.status?t.classList.add("off"):t.classList.remove("off")}renderCircleState(t){return`\n            <svg id="${t.id}C" class="circle-state"\n                viewbox="0 0 100 100"\n                style="${t.brightness&&!t.state?"--percentage:"+t.brightness/2.55:""}"\n            >\n                <path\n                    id="progress"\n                    stroke-width="3"\n                    stroke="#aaabad"\n                    fill="none"\n                    d="M50 10\n                    a 40 40 0 0 1 0 80\n                    a 40 40 0 0 1 0 -80"\n                ></path>\n                <text id="id="${t.id}IT'" x="50" y="50" fill="#7d7e80" text-anchor="middle" dy="7" font-size="20">\n                    ${t.brightness&&"on"===this.buttonstate.status?(t.brightness/2.55).toFixed(0)+"%":t.circle}\n                </text>\n            </svg>\n        `}renderButtonContent(t,e){this._checkButtonState(t,e),t.innerHTML=`\n            <ha-icon id="${e.id}I" class="icon ${this.buttonstate.status}" icon="${e.icon}"></ha-icon>\n            ${this.renderCircleState(e)}\n            <div class="sc-button-data">  \n            <div class="sc-button-name">${e.name.toUpperCase()}</div>\n            <div id="${e.id}V" class="sc-button-value">${e.value} ${e.unit}</div>\n            <div id="${e.id}D" class="sc-button-date">${e.date}</div>\n            </div>\n        `}getButtonData(t){if(!t)return null;const e=t.entity_id.split(".")[0]||"alert",n=t.entity_id.split(".")[1],i=this.hassEntities.find(e=>e.entity_id===t.entity);return{id:t.entity_id,name:t.name||n||t.attributes.name||t.entity_id,type:e,value:localValue(t.state,this.locale)||"",unit:t.unit||t.attributes.unit_of_measurement||"",valuetype:t.type||typeof t.state,date:localDatetime(t.last_updated,this.locale)||"",circle:this._calculateTime(t.last_updated)||"",icon:t.icon||t.attributes.icon||HASS_ICONS[e]||HASS_ICONS.default,status:this.buttonstate.status||"off",brightness:i&&i.attributes?i.attributes.brightness:null,rgb_color:i&&i.attributes?i.attributes.rgb_color:null,xy_color:i&&i.attributes?i.attributes.xy_color:null}}_toggle(t,e){this.hass&&this.hass.callService("homeassistant",e||"toggle",{entity_id:t.entity_id})}_fire(t,e){const n=new Event(t,{bubbles:!0,cancelable:!1,composed:!0});return n.detail=e||{},this.shadowRoot.dispatchEvent(n),n}_clickAction(t){this._fire("hass-more-info",{entityId:t})}updateButtons(){this.entities.forEach((t,e)=>{const n=this.hassEntities.find(e=>e.entity_id===t.entity),i=this.getButtonData(t);if(t.last_updated!==n.last_updated||"light"===i.type){"light"===i.type&&(i.brightness=n.attributes.brightness||null,i.rgb_color=n.attributes.rgb_color||null,i.xy_color=n.attributes.xy_color||null),i.value=localValue(n.state,this.locale)||"",i.date=localDatetime(n.last_updated,this.locale)||"",i.circle=this._calculateTime(n.last_updated)||"";const e=this.buttonslist[t.entity_id];this.renderButtonContent(e,i)}})}renderButtons(){this.entities.forEach((t,e)=>{const n=this.getButtonData(t);if(n){const e=document.createElement("div");e.setAttribute("class","sc-button buttons on"),e.id=t.entity_id,t.style&&(e.style.cssText=t.style.replaceAll("\n","")),n.value===localValue(t.last_updated,this.locale)&&(n.value=t.text||"Status",n.unit=""),this.renderButtonContent(e,n),this.shadowRoot&&(e.onclick=this._clickAction.bind(this,t.entity_id)),this.buttonslist[e.id]=e,this.button_layer.append(e)}})}render(){this.entities&&this.entities.length&&this.parentNode&&(this.button_layer=document.createElement("div"),this.button_layer.setAttribute("class","sc-buttons clearfix"),this.set_buttonstyle(),this.update=!1,this.renderButtons(),this.parentNode.append(this.button_layer))}}class simpleClock{constructor(t){this.parentNode=t.parentNode,this.locale=t.locale,this.options=t.clockoptions,this.clocklayer=null,this.parentNode&&this.addClockLayer()}set_clockstyle(){if(!this.clocklayer)return!1;const t=document.createElement("style");return t.textContent="\n            .sc-clock{\n                position:relative;  \n                text-align: center;\n                width: 100%;\n                padding-top: 1em;\n                margin: 0 auto;\n                letter-spacing: 0.1em;\n            }  \n            .sc-time {\n                font-size: 3.0em;\n                line-height: 1em;\n                letter-spacing: 0.1em;\n            }\n            .sc-date {\n                ext-transform: uppercase;\n                font-size: 1.3em;\n                font-weight: 400;\n                line-height: 1.5em;\n                margin-bottom: 1em;\n            }\n            ",this.parentNode.append(t),!0}addClockLayer(){this.clocklayer||(this.clocklayer=document.createElement("div"),this.clocklayer.setAttribute("class","sc-clock"),this.set_clockstyle(),this.parentNode.appendChild(this.clocklayer)),this.setClockTime(),setInterval(this.setClockTime.bind(this),6e4)}setClockTime(){this.options=this.options||{weekday:"short",month:"short",day:"numeric"};let t=new Date,e=t.getHours(),n=t.getMinutes();const i=t.toLocaleDateString(this.locale,this.options).replaceAll(".","");n=n<10?"0"+n:n,this.clocklayer.innerHTML=`<div class="sc-time">${e}:${n}</div><div class="sc-date">${i}</div>`}}const HASS_ICONS={default:"hass:eye",alert:"hass:alert",alexa:"hass:amazon-alexa",automation:"hass:playlist-play",calendar:"hass:calendar",camera:"hass:video",climate:"hass:thermostat",configurator:"hass:settings",conversation:"hass:text-to-speech",device_tracker:"hass:account",fan:"hass:fan",google_assistant:"hass:google-assistant",group:"hass:google-circles-communities",history_graph:"hass:chart-line",homeassistant:"hass:home-assistant",homekit:"hass:home-automation",image_processing:"hass:image-filter-frames",input_boolean:"hass:drawing",input_datetime:"hass:calendar-clock",input_number:"hass:ray-vertex",input_select:"hass:format-list-bulleted",input_text:"hass:textbox",light:"hass:lightbulb",mailbox:"hass:mailbox",notify:"hass:comment-alert",persistent_notification:"hass:bell",person:"hass:account",plant:"hass:flower",proximity:"hass:apple-safari",remote:"hass:remote",scene:"hass:google-pages",script:"hass:file-document",sensor:"hass:eye",binarysensor:"hass:eye",simple_alarm:"hass:bell",sun:"hass:white-balance-sunny",switch:"hass:flash",timer:"hass:timer",updater:"hass:cloud-upload",vacuum:"hass:robot-vacuum",water_heater:"hass:thermometer",weather:"hass:weather-cloudy",weblink:"hass:open-in-new",zone:"hass:map-marker"};function formatDate(t,e){const n=new Date(t);function i(t){return t.toString().length<2?"0"+t:t}return"timestamp"==e?n.getUTCFullYear()+"-"+i(n.getUTCMonth()+1)+"-"+i(n.getUTCDate())+" "+i(n.getUTCHours())+":"+i(n.getUTCMinutes())+":"+i(n.getUTCSeconds()):e.replace(/%([a-zA-Z])/g,function(t,e){switch(e){case"Y":return n.getUTCFullYear();case"M":return i(n.getUTCMonth()+1);case"d":return i(n.getUTCDate());case"H":return i(n.getUTCHours());case"m":return i(n.getUTCMinutes());case"s":return i(n.getUTCSeconds());default:throw new Error("Unsupported format code: "+e)}})}function typeOf(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function localDate(t,e){if(!t)return"";e||(e=navigator.language||navigator.userLanguage||"en-GB"),t=t.split("T")[0];const n=new Date(t.replace(/-/g,"/"));return isNaN(n)?t:new Intl.DateTimeFormat(e).format(n)}function localDatetime(t,e){if(!t)return"";e||(e=navigator.language||navigator.userLanguage||"en-GB"),t=t.replace("T"," ");const n=new Date(t.replace(/-/g,"/"));return isNaN(n)?t:new Intl.DateTimeFormat(e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(n)}function timeStampLabel(t,e){if(!t)return"";e||(e=navigator.language||navigator.userLanguage||"en-GB");const n=new Date(t.replace(/-/g,"/"));return isNaN(n)?t:new Intl.DateTimeFormat(e,{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(n).split(",")}function reject(t,e){return Object.keys(t).filter(t=>!e.includes(t)).map(e=>Object.assign({},{[e]:t[e]})).reduce((t,e)=>Object.assign(t,e),{})}function num(t){return t===parseInt(t)?1*parseInt(t):1*parseFloat(t).toFixed(2)}const getType=function(t){return"boolean"==typeof t?"boolean":"number"==typeof t||!isNaN(parseFloat(t))&&isFinite(t)?"number":Number.isNaN(Number(new Date(t)))?"string"==typeof t?"string":{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase():"date"};function localValue(t,e){return t?(e||(e=navigator.language||navigator.userLanguage||"en-GB"),"date"===getType(t)?localDate(t,e):"number"===getType(t)?parseInt(t)===t?num(t).toLocaleString(e):num(t).toLocaleString(e,{minimumFractionDigits:2,maximumFractionDigits:2}):t):""}function deepMerge(...t){let e={};for(const n of t)if(n instanceof Array)e instanceof Array||(e=[]),e=[...e,...n];else if(n instanceof Object)for(let[t,i]of Object.entries(n))i instanceof Object&&t in e&&(i=deepMerge(e[t],i)),e={...e,[t]:i};return e}const appinfo={name:"✓ custom:simple-card",version:"0.0.5"};console.info("%c "+appinfo.name+"     %c ▪︎▪︎▪︎▪︎ Version: "+appinfo.version+" ▪︎▪︎▪︎▪︎ ","color:#FFFFFF; background:#3498db;display:inline-block;font-size:12px;font-weight:200;padding: 4px 0 4px 0","color:#2c3e50; background:#ecf0f1;display:inline-block;font-size:12px;font-weight:200;padding: 4px 0 4px 0");class SimpleCard extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._initialized=!1,this.entities=[],this.logenabled=!0}logInfo(...t){this.logenabled&&console.info((new Date).toISOString(),appinfo.name,...t)}setHassEntities(){this._hass&&(this.hassEntities=this.entities.map(t=>this._hass.states[t.entity]).filter(t=>void 0!==t))}set hass(t){if(void 0!==t&&this._initialized&&(this._hass=t,this.setHassEntities(),this.buttons&&"buttons"===this.mode&&(this.buttons.hass=this._hass,this.buttons.hassEntities=this.hassEntities,!1===this.buttons.intialized&&this.entities&&this.buttons.updateButtons()),this.updateData(),!this.skipRender)){if(!this.init){if(this.init=!0,this.entities=[],"buttons"===this.mode)for(let t of this._config.entities)if(this._hass.states[t.entity]){let e={...this._hass.states[t.entity],...t};this.entities.push(e)}this.card||this.createCard()}this.skipRender=!0}}updateData(){if(this.mode&&this._hass&&this.entities)switch(this.mode){case"buttons":this.buttons&&this.hassEntities&&this.hassEntities.length&&(this.buttons.hassEntities=this.hassEntities,this.buttons.updateButtons())}}addCss(){const t=document.createElement("style");return t.setAttribute("id","sc-"+this.id),t.textContent="\n          .ha-simplecard-buttons{\n              position: relative;\n              background: transparent;\n          }\n          .sc-icon{\n            position: relative;\n            top: -3px;\n            padding-right: 6px;\n          }\n          h2.sc-title{\n            font-size: 1.75em;\n            font-weight: 500;\n            padding-top: 1em;\n            width: 95%;\n            overflow:hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            display: inline-block;\n            margin: 0 0 0.5em 0.5em;\n          }\n          p.sc-text{\n            font-size: 1.2em;\n            font-weight: 300;\n            margin: 0 1.5em;\n          }\n        ",this.root.append(t),!0}createCardContent(t){if(t){if(this._config.title){const e=document.createElement("h2");if(e.setAttribute("class","sc-title"),this._config.icon){const t=document.createElement("ha-icon");t.setAttribute("icon",this._config.icon),t.setAttribute("class","sc-icon"),t.style.cssText="--mdc-icon-size: 1.2em",e.appendChild(t);const n=document.createElement("span");n.innerHTML=this._config.title,e.appendChild(n)}else e.innerHTML=this._config.title;t.appendChild(e)}if(this._config.clock){new simpleClock({parentNode:t,locale:this.locale})}if("buttons"==this.mode&&(this.buttons=new buttons({hass:this._hass,shadowRoot:this.shadowRoot,parentNode:t,entities:this.entities,hassEntities:this.hassEntities,locale:this.locale})),this._config.text){let e=document.createElement("p");e.setAttribute("class","sc-text"),this._config.icon&&(e.style.cssText="margin-left: 2.8em;"),e.innerHTML=this._config.text,t.appendChild(e)}}}createCard(){const t=Math.random().toString(36).substr(2,9);this.id="card-"+t,this.card=document.createElement("ha-card"),this.card.setAttribute("class","ha-simplecard"),"buttons"==this.mode&&(this.card.setAttribute("class","ha-simplecard-buttons"),this.card.style.boxShadow="none",this.card.style.borderRadius="0"),this.addCss();const e=document.createElement("div");e.id="content-"+t,e.style.height=e.style.minHeight=this.height+"px",this.createCardContent(e),this.card.appendChild(e),this.root.appendChild(this.card),this.setAttribute("title","")}_checkLocale(t){try{Intl.getCanonicalLocales(t)}catch(t){return console.error(" RangeError: invalid language tag:",_this.config),navigator.language||navigator.userLanguage}return t}setConfig(t){if(this.root=this.shadowRoot,!this._config){this._config=t,this.id=Math.random().toString(36).substr(2,9);const e=navigator.language||navigator.userLanguage||"en-GB";this.locale=t.locale||e,this._checkLocale(),this.entities=[],this.logenabled=t.logger||!0,this.height=this._config.height||"100%",this.title=this._config.title,this.text=this._config.text,this.mode=this._config.mode,this.skipRender=!1,this.entities=[],this.hassEntities=[],this.loginfo_enabled=!0,this._initialized=!0}}getCardSize(){return 3}}customElements.define("simple-card",SimpleCard);